<html lang="en"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Dashboard Template for Bootstrap</title>

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/dashboard.css" rel="stylesheet">
<style>#content > #right > .dose > .dosesingle,
#content > #center > .dose > .dosesingle
{display:none !important;}</style></head>

  <style>
    .container-fluid {
      background-color: #ecf0f5;
    }
    .sidebar { 
      background-color: #333 !important;
      color: white;
    }
    .navbar { 
      background-color: #367fa9 !important;
    }

    .area {
  /* fill: steelblue; */
  clip-path: url(#clip);
}

.zoom {
  cursor: move;
  fill: none;
  pointer-events: all;
}
  </style>

  <body>
    <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
      <a class="navbar-brand" href="#">Dashboard</a>
      <button class="navbar-toggler d-lg-none" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarsExampleDefault">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item active">
            <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
          </li>
          <!-- <li class="nav-item">
            <a class="nav-link" href="#">Settings</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Profile</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Help</a>
          </li> -->
        </ul>
        <!-- <form class="form-inline mt-2 mt-md-0">
          <input class="form-control mr-sm-2" type="text" placeholder="Search" aria-label="Search">
          <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
        </form> -->
      </div>
    </nav>

    <div class="container-fluid">
      <div class="row">
        <nav class="col-sm-3 col-md-2 d-none d-sm-block bg-light sidebar">
          <ul class="nav nav-pills flex-column">
            <li class="nav-item">
              <a class="nav-link active" href="#">Overview <span class="sr-only">(current)</span></a>
            </li>
            <!-- <li class="nav-item">
              <a class="nav-link" href="#">Reports</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Analytics</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Export</a>
            </li> -->
          </ul>

        </nav>

        <main class="col-sm-9 ml-sm-auto col-md-10 pt-3" role="main">
          <h1>Log Data</h1>

          <section class="row text-center placeholders">
            <div class="col-6 col-lg-6 placeholder">
              <svg id="size" width="960" height="500"></svg>
              <h4>Label</h4>
              <div class="text-muted">Something else</div>
            </div>
            <div class="col-6 col-lg-6 placeholder">
              <h4>Label</h4>
              <span class="text-muted">Something else</span>
            </div>
          </section>

          <div class="table-responsive">
            <table id="data_table" class="table table-striped">
              <thead>
                <tr>
                  <!-- <th>Timestamp</th>
                  <th>Action</th>
                  <th>Size</th> -->
                </tr>
              </thead>
            </table>
          </div>
        </main>
      </div>
    </div>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script   src="https://code.jquery.com/jquery-3.2.1.min.js"   integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="   crossorigin="anonymous"></script>
    <!-- <script src="js/jquery-slim.min.js"></script> -->
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="https://d3js.org/d3.v4.js"></script>
    <script src="js/d3-time-format.js"></script>
    <script src="https://unpkg.com/d3fc/build/d3fc.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>

    <script src="js/line-chart.js"></script>

    <script>
      var appendColumnNames = true;
      var errorNums = [-1];
      var columns = ["Timestamp", "Action", "Size"];
      function initializeTable(table_id) {
        var table_header = document.querySelector("#" + table_id + " tr");
        for (var i = 0; i < columns.length; i++) {
          var th = document.createElement("th");
          th.innerHTML = columns[i];
          table_header.appendChild(th);
        }
      }
    </script>
    <script>
      var psv = d3.dsvFormat(" ");
      var logData;

      $.get("data.log", function (data) {
        // add column names to top of log
        if (appendColumnNames) {
          data = columns.join(" ") + "\n" + data;
        }

        logData = psv.parse(data);
        
        var cleanData = []; // data without errors
        var errorData = []; // error data
        logData.forEach(function(d) {
          if (isNaN(d["Size"]) || errorNums.includes(+d["Size"])) {
            errorData.push(d);
          } else {
            d["Size"] = +d["Size"];
            cleanData.push(d);
          }
        });
        draw_chart(JSON.parse(JSON.stringify(cleanData)), "size", "Timestamp", "Size", "Action");
        initializeTable("data_table");

        $('#data_table').DataTable( {
          data: logData,
          "columnDefs": [
              { "type": "num", "targets": 2 }
          ],
          columns: [
            {data: "Timestamp"},
            {data: "Action"},
            {data: "Size"}
          ]
        });
      });
    </script>
</body></html>